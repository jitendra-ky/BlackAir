<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Builder - {% block title %}Professional Resume Creator{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-blue': '#3b82f6',
                        'brand-gray': '#6b7280',
                    }
                }
            }
        }
    </script>
    <!-- <link rel="stylesheet" href="/static/css/style.css"> -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">    
    <nav class="bg-white border-b border-gray-200 px-6 py-3 flex justify-between items-center">
        <a href="/" class="font-medium text-brand-blue hover:text-blue-600">Dashboard</a>
        <div class="nav-auth flex items-center gap-3">
            <a href="/login/" id="nav-login" class="text-gray-600 hover:text-brand-blue px-3 py-1 rounded">Login</a>
            <a href="/signup/" id="nav-signup" class="bg-brand-blue text-white px-3 py-1 rounded hover:bg-blue-600">Sign Up</a>
            <div class="user-profile-nav relative" id="user-profile-nav" style="display:none;">
                <div class="user-avatar flex items-center gap-2 px-3 py-1 bg-brand-blue text-white rounded cursor-pointer" id="user-avatar">
                    <span id="user-name">User</span>
                </div>
                <div class="profile-dropdown absolute top-full right-0 bg-white rounded border shadow-lg min-w-40 z-50 hidden" id="profile-dropdown">
                    <a href="#" id="view-profile" class="block px-3 py-2 text-gray-700 hover:bg-gray-50 border-b">View Profile</a>
                    <a href="#" id="nav-logout" class="block px-3 py-2 text-gray-700 hover:bg-gray-50">Logout</a>
                </div>
            </div>
        </div>
    </nav>
    
    <main class="max-w-4xl mx-auto mt-6 p-6 bg-white rounded border min-h-[60vh]">
        {% block content %}{% endblock %}
    </main>

    <!-- Profile Modal -->
    <div id="profile-modal" class="modal fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center" style="display:none;">
        <div class="modal-content bg-white rounded border w-11/12 max-w-md max-h-[90vh] overflow-y-auto">
            <div class="modal-header flex justify-between items-center p-4 border-b">
                <h2 class="text-lg font-medium text-gray-900">My Profile</h2>
                <span class="close text-xl cursor-pointer text-gray-400 hover:text-gray-600 p-1" id="close-profile-modal">&times;</span>
            </div>
            <div class="modal-body p-4">
                <form id="profile-form">
                    <div class="form-group mb-4">
                        <label for="profile-username" class="block mb-1 font-medium text-gray-700 text-sm">Username:</label>
                        <input type="text" id="profile-username" name="username" readonly class="w-full px-3 py-2 border rounded text-sm bg-gray-50 text-gray-600">
                    </div>
                    <div class="form-group mb-4">
                        <label for="profile-email" class="block mb-1 font-medium text-gray-700 text-sm">Email:</label>
                        <input type="email" id="profile-email" name="email" readonly class="w-full px-3 py-2 border rounded text-sm bg-gray-50 text-gray-600">
                    </div>
                    <div class="form-group mb-4">
                        <label for="profile-city" class="block mb-1 font-medium text-gray-700 text-sm">City:</label>
                        <input type="text" id="profile-city" name="city" placeholder="Enter your city" class="w-full px-3 py-2 border rounded text-sm focus:outline-none focus:border-brand-blue">
                    </div>
                    <div class="form-group mb-4">
                        <label for="profile-country" class="block mb-1 font-medium text-gray-700 text-sm">Country:</label>
                        <input type="text" id="profile-country" name="country" placeholder="Enter your country" class="w-full px-3 py-2 border rounded text-sm focus:outline-none focus:border-brand-blue">
                    </div>
                    <div class="form-actions flex gap-3 justify-end mt-6 pt-3 border-t">
                        <button type="submit" class="btn bg-brand-blue text-white px-4 py-2 rounded hover:bg-blue-600">Update Profile</button>
                        <button type="button" class="btn bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300" id="cancel-profile">Cancel</button>
                    </div>
                </form>
                <div id="profile-error" class="error-message bg-red-50 text-red-700 px-3 py-2 rounded mt-3 border border-red-200 hidden"></div>
                <div id="profile-success" class="success-message bg-green-50 text-green-700 px-3 py-2 rounded mt-3 border border-green-200 hidden"></div>
            </div>
        </div>
    </div>    <script src="/static/js/state.js" type="module"></script>
    <script src="/static/js/utils.js" type="module"></script>
    <script src="/static/js/auth.js" type="module"></script>
    <script src="/static/js/profile.js" type="module"></script>
    <script>
      // Simple nav logic for login/logout
      if (localStorage.getItem('accessToken')) {
        document.getElementById('nav-login').style.display = 'none';
        document.getElementById('nav-signup').style.display = 'none';
        document.getElementById('user-profile-nav').style.display = 'block';
        
        // Load user data
        loadUserData();
      }
      
      // Logout functionality
      document.getElementById('nav-logout').onclick = function() {
        localStorage.clear();
        window.location.href = '/login/';
      };

      // Profile dropdown toggle
      document.getElementById('user-avatar').onclick = function(e) {
        e.stopPropagation();
        const dropdown = document.getElementById('profile-dropdown');
        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
      };

      // Close dropdown when clicking outside
      document.addEventListener('click', function() {
        document.getElementById('profile-dropdown').style.display = 'none';
      });      // Load user data function
      function loadUserData() {
        $.ajax({
          url: '/api/auth/user/',
          type: 'GET',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('accessToken')}`
          },
          success: function(userData) {
            document.getElementById('user-name').textContent = userData.username;
          },
          error: function(xhr, status, error) {
            console.error('Failed to load user data:', error);
            if (xhr.status === 401) {
              // Token might be expired, redirect to login
              localStorage.clear();
              window.location.href = '/login/';
            }
          }
        });
      }
    </script>
</body>
</html>
